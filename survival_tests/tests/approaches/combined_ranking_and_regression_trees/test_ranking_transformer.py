import os
import unittest

import pandas as pd

from approaches.combined_ranking_regression_trees.ranking_transformer import calculate_ranking_from_performance_data
from aslib_scenario import ASlibScenario


class TestRankingTransformer(unittest.TestCase):
    def setUp(self) -> None:
        test_scenario_name = "MAXSAT15-PMS-INDU"
        scenario = ASlibScenario()
        scenario.read_scenario(os.path.join("data", "aslib_data-master", test_scenario_name))
        self.performance_data = scenario.performance_data.iloc[0:5]
        self.performance_data.loc["pms_industrial/aes/mul_8_3.wcnf", "LMHS-C"] = 53.406
        self.performance_data.loc["pms_industrial/aes/mul_8_9.wcnf", "CCLS2akms"] = 1478.927
        self.performance_data.loc["pms_industrial/aes/mul_8_9.wcnf", "LMHS-C"] = 1478.927
        self.performance_data.loc["pms_industrial/aes/mul_8_9.wcnf", "LMHS-I"] = 1478.927

    def test_transform_with_ties(self):
        ranked_data = calculate_ranking_from_performance_data(self.performance_data.values)
        self.assertEqual(
            ranked_data,
            [
                {
                    0: 29,
                    1: 29,
                    2: 29,
                    3: 29,
                    4: 29,
                    5: 29,
                    6: 29,
                    7: 29,
                    8: 29,
                    9: 29,
                    10: 29,
                    11: 29,
                    12: 29,
                    13: 29,
                    14: 29,
                    15: 29,
                    16: 29,
                    17: 29,
                    18: 29,
                    19: 29,
                    20: 29,
                    21: 29,
                    22: 29,
                    23: 29,
                    24: 29,
                    25: 29,
                    26: 29,
                    27: 29,
                    28: 29,
                },
                {
                    0: 29,
                    1: 29,
                    2: 29,
                    3: 29,
                    4: 29,
                    5: 29,
                    6: 29,
                    7: 29,
                    8: 29,
                    9: 29,
                    10: 29,
                    11: 29,
                    12: 29,
                    13: 29,
                    14: 29,
                    15: 29,
                    16: 29,
                    17: 29,
                    18: 29,
                    19: 29,
                    20: 29,
                    21: 29,
                    22: 29,
                    23: 29,
                    24: 29,
                    25: 29,
                    26: 29,
                    27: 29,
                    28: 29,
                },
                {
                    0: 29,
                    1: 29,
                    2: 29,
                    3: 29,
                    4: 29,
                    5: 29,
                    6: 29,
                    7: 29,
                    8: 29,
                    9: 29,
                    10: 29,
                    11: 29,
                    12: 29,
                    13: 29,
                    14: 29,
                    15: 29,
                    16: 29,
                    17: 29,
                    18: 29,
                    19: 29,
                    20: 29,
                    21: 29,
                    22: 29,
                    23: 29,
                    24: 29,
                    25: 29,
                    26: 29,
                    27: 29,
                    28: 29,
                },
                {
                    3: 0.5,
                    4: 0.5,
                    5: 2,
                    2: 3,
                    0: 29,
                    1: 29,
                    6: 29,
                    7: 29,
                    8: 29,
                    9: 29,
                    10: 29,
                    11: 29,
                    12: 29,
                    13: 29,
                    14: 29,
                    15: 29,
                    16: 29,
                    17: 29,
                    18: 29,
                    19: 29,
                    20: 29,
                    21: 29,
                    22: 29,
                    23: 29,
                    24: 29,
                    25: 29,
                    26: 29,
                    27: 29,
                    28: 29,
                },
                {
                    3: 1,
                    4: 1,
                    0: 29,
                    1: 1,
                    2: 29,
                    5: 29,
                    6: 29,
                    7: 29,
                    8: 29,
                    9: 29,
                    10: 29,
                    11: 29,
                    12: 29,
                    13: 29,
                    14: 29,
                    15: 29,
                    16: 29,
                    17: 29,
                    18: 29,
                    19: 29,
                    20: 29,
                    21: 29,
                    22: 29,
                    23: 29,
                    24: 29,
                    25: 29,
                    26: 29,
                    27: 29,
                    28: 29,
                },
            ],
        )
